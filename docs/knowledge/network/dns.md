# DNS

> 把网址转换成 ip 的过程，互联网中每一台机器都有唯一标识的 IP 地址，但是这个 IP 不好记，所以需要一个网址和 IP 的转换，即 DNS 解析。

## 基本概念

![](https://limy-1309594960.cos.ap-beijing.myqcloud.com/202208261411994_dns.webp)

顶级域（一级域名）: .com、.cn、.org 等

二级域名: zhihu.com、baidu.com、sina.cn 等

子域名（三级及以下）: dev.sina.cn、zhuanlan.zhihu.com

## 解析过程

#### 递归查询

1. 主机向本地域名服务器(ldns)的查询一般都是采用递归查询。
2. 递归查询只会返回两种信息：要么是所要查询的 IP 地址，要么是查询失败。

![](https://limy-1309594960.cos.ap-beijing.myqcloud.com/202208261436083_dns_recursion.png)

#### 迭代查询

1. 本地域名服务器向根域名服务器的查询是迭代查询。

![](https://limy-1309594960.cos.ap-beijing.myqcloud.com/202208261438740_dns_iteration.jpeg)

:::tip

举个 🌰 来描述递归查询和迭代查询，有两位同学 A 和 B，A 遇到了一个问题

**递归**: A 请教 B，B 去问老师，得到结果后再告诉 A；<br />
**迭代**: B 说我不会，但是老师会，你去问下老师。 A 去问老师 得到结果;

:::

#### 整体流程

输入www.google.com网址后，首先在本地的域名服务器中查找，没找到去根域名服务器查找，没有再去com顶级域名服务器查找，，如此的类推下去，直到找到IP地址，然后把它记录在本地，供下次使用。大致过程就是. -> .com -> google.com. -> www.google.com.。 (你可能觉得我多写 .，并木有，这个.对应的就是根域名服务器，默认情况下所有的网址的最后一位都是.，既然是默认情况下，为了方便用户，通常都会省略，浏览器在请求 DNS 的时候会自动加上)

## 优化

### 1. 缓存

- 浏览器缓存（chrome://dns/）
- 系统缓存（/etc/hosts）
- 路由器缓存
- 互联网服务供应商(ISP) 服务器缓存
- 根域名服务器缓存
- 顶级域名服务器缓存
- 主域名服务器缓存

### 2. 负载均衡

将服务部署在多个服务器上，DNS 根据服务器的负载、该机器的距离等因素返回合适的 ip 给用户

## 参考

- [掘金：DNS 域名解析](https://juejin.cn/post/7132799176332541966)
- [知乎：DNS 解析的过程是什么，求详细的？](https://www.zhihu.com/question/23042131)
