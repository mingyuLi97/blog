import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.fa80b722.js";const D=JSON.parse('{"title":"聚合函数","description":"","frontmatter":{},"headers":[],"relativePath":"backend/mysql/aggregate.md","filePath":"backend/mysql/aggregate.md"}'),t={name:"backend/mysql/aggregate.md"},e=l(`<h1 id="聚合函数" tabindex="-1">聚合函数 <a class="header-anchor" href="#聚合函数" aria-label="Permalink to &quot;聚合函数&quot;">​</a></h1><h2 id="max、min、avg、sum" tabindex="-1">MAX、MIN、AVG、SUM <a class="header-anchor" href="#max、min、avg、sum" aria-label="Permalink to &quot;MAX、MIN、AVG、SUM&quot;">​</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#56B6C2;">MAX</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> highest,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">MIN</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> lowest,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">AVG</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> average,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">SUM</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> total,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">-- 所有的变量都可以执行运算</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">SUM</span><span style="color:#ABB2BF;">(invoice_total * </span><span style="color:#D19A66;">10</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> total2</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">sql_invoicing</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">invoices</span><span style="color:#ABB2BF;">;</span></span></code></pre></div><h2 id="count" tabindex="-1">COUNT <a class="header-anchor" href="#count" aria-label="Permalink to &quot;COUNT&quot;">​</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">-- 查询表中所有的 row</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">COUNT</span><span style="color:#ABB2BF;">(*) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> counts,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">-- 查询某个字段，null 会被过滤</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">COUNT</span><span style="color:#ABB2BF;">(payment_date) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> payment_date_count,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#7F848E;font-style:italic;">-- 去重复查询</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">COUNT</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">DISTINCT</span><span style="color:#ABB2BF;"> client_id) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> counts</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">sql_invoicing</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">invoices</span><span style="color:#ABB2BF;">;</span></span></code></pre></div><h2 id="group-by" tabindex="-1">GROUP BY <a class="header-anchor" href="#group-by" aria-label="Permalink to &quot;GROUP BY&quot;">​</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">	client_id,</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#56B6C2;">SUM</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> total</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> invoices</span></span>
<span class="line"><span style="color:#C678DD;">WHERE</span><span style="color:#ABB2BF;"> invoice_date </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&#39;2019-07-01&#39;</span></span>
<span class="line"><span style="color:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;"> client_id</span></span>
<span class="line"><span style="color:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;"> total </span><span style="color:#C678DD;">DESC</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- 多表 group by</span></span>
<span class="line"><span style="color:#C678DD;">SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#D19A66;">payments</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">date</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#D19A66;">payment_methods</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">name</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">SUM</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">payments</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">amount</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> total_pay</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> payments</span></span>
<span class="line"><span style="color:#C678DD;">JOIN</span><span style="color:#ABB2BF;"> payment_methods</span></span>
<span class="line"><span style="color:#C678DD;">ON</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">payment_methods</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">payment_method_id</span><span style="color:#ABB2BF;"> </span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">payments</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">payment_method</span></span>
<span class="line"><span style="color:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">payments</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">date</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">payment_methods</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">name</span></span>
<span class="line"><span style="color:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">payments</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">date</span></span></code></pre></div><h2 id="having" tabindex="-1">HAVING <a class="header-anchor" href="#having" aria-label="Permalink to &quot;HAVING&quot;">​</a></h2><p>HAVING 用户过滤分组</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">SELECT</span></span>
<span class="line"><span style="color:#ABB2BF;">	client_id,</span></span>
<span class="line"><span style="color:#ABB2BF;">	</span><span style="color:#56B6C2;">SUM</span><span style="color:#ABB2BF;">(invoice_total) </span><span style="color:#C678DD;">as</span><span style="color:#ABB2BF;"> total</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> invoices</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">--</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">-- WHERE total &gt; 400</span></span>
<span class="line"><span style="color:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;"> client_id</span></span>
<span class="line"><span style="color:#C678DD;">HAVING</span><span style="color:#ABB2BF;"> total </span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">400</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">HAVING 和 WHERE</p><ol><li>两者都是过滤功能，<code>WHERE</code> 是过滤行，而 <code>HAVING</code> 是过滤分组</li><li><code>WHERE</code> 用于 <code>GROUP BY</code> 之前，过滤的条件是表中的字段，例：上面示例中 <code>SELECT</code> 中的 <code>total</code> 是无法使用的</li><li><code>HAVING</code> 用于 <code>GROUP BY</code> 之后，过滤条件是 <code>SELECT</code> 中的字段</li></ol></div><h2 id="rollup" tabindex="-1">ROLLUP <a class="header-anchor" href="#rollup" aria-label="Permalink to &quot;ROLLUP&quot;">​</a></h2><p>用于生成多级汇总报表的操作符。它可以在 <code>GROUP BY</code> 子句中使用，用于生成超过一级的聚合结果。 <code>ROLLUP</code> 可以按照指定的列进行分组，并为每个分组生成一个汇总行，同时还会生成总体的汇总行。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki one-dark-pro"><code><span class="line"><span style="color:#C678DD;">SELECT</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">state</span><span style="color:#ABB2BF;">, city, </span><span style="color:#56B6C2;">sum</span><span style="color:#ABB2BF;">(invoice_total)</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> invoices i</span></span>
<span class="line"><span style="color:#C678DD;">JOIN</span><span style="color:#ABB2BF;"> clients c </span><span style="color:#C678DD;">USING</span><span style="color:#ABB2BF;">(client_id)</span></span>
<span class="line"><span style="color:#C678DD;">GROUP BY</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">state</span><span style="color:#ABB2BF;">, city </span><span style="color:#C678DD;">WITH</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">ROLLUP</span><span style="color:#ABB2BF;">;</span></span></code></pre></div><table><thead><tr><th style="text-align:left;">State</th><th style="text-align:center;">City</th><th style="text-align:center;">sum(invoice_total)</th></tr></thead><tbody><tr><td style="text-align:left;">WV</td><td style="text-align:center;">Huntington</td><td style="text-align:center;">101.79</td></tr><tr><td style="text-align:left;">WV</td><td style="text-align:center;">-</td><td style="text-align:center;">101.79</td></tr><tr><td style="text-align:left;">OR</td><td style="text-align:center;">Portland</td><td style="text-align:center;">980.02</td></tr><tr><td style="text-align:left;">OR</td><td style="text-align:center;">-</td><td style="text-align:center;">980.02</td></tr><tr><td style="text-align:left;">NY</td><td style="text-align:center;">Syracuse</td><td style="text-align:center;">802.89</td></tr><tr><td style="text-align:left;">NY</td><td style="text-align:center;">-</td><td style="text-align:center;">802.89</td></tr><tr><td style="text-align:left;">CA</td><td style="text-align:center;">San Francisco</td><td style="text-align:center;">705.90</td></tr><tr><td style="text-align:left;">CA</td><td style="text-align:center;">-</td><td style="text-align:center;">705.90</td></tr><tr><td style="text-align:left;">-</td><td style="text-align:center;">-</td><td style="text-align:center;">2590.60</td></tr></tbody></table>`,15),o=[e];function p(c,r,B,y,i,d){return a(),n("div",null,o)}const F=s(t,[["render",p]]);export{D as __pageData,F as default};
